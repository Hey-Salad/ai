<!DOCTYPE html>
<html>
<head>
  <title>Auth Test - HeySalad AI</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
    .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>HeySalad AI - Auth API Test</h1>
  
  <div class="test">
    <h2>Test Signup</h2>
    <input type="email" id="signup-email" placeholder="Email" value="test@example.com">
    <input type="password" id="signup-password" placeholder="Password" value="testpass123">
    <input type="text" id="signup-name" placeholder="Name (optional)" value="Test User">
    <button onclick="testSignup()">Test Signup</button>
    <pre id="signup-result"></pre>
  </div>

  <div class="test">
    <h2>Test Login</h2>
    <input type="email" id="login-email" placeholder="Email" value="test@example.com">
    <input type="password" id="login-password" placeholder="Password" value="testpass123">
    <button onclick="testLogin()">Test Login</button>
    <pre id="login-result"></pre>
  </div>

  <div class="test">
    <h2>Test Get User</h2>
    <button onclick="testGetUser()">Test Get User (requires login)</button>
    <pre id="user-result"></pre>
  </div>

  <script>
    async function testSignup() {
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const name = document.getElementById('signup-name').value;
      const result = document.getElementById('signup-result');
      
      try {
        result.textContent = 'Testing signup...';
        const response = await fetch('/api/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, name })
        });
        
        const data = await response.json();
        result.className = response.ok ? 'success' : 'error';
        result.textContent = JSON.stringify(data, null, 2);
        
        if (data.token) {
          localStorage.setItem('heysalad_ai_token', data.token);
        }
      } catch (error) {
        result.className = 'error';
        result.textContent = 'Error: ' + error.message;
      }
    }

    async function testLogin() {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const result = document.getElementById('login-result');
      
      try {
        result.textContent = 'Testing login...';
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        result.className = response.ok ? 'success' : 'error';
        result.textContent = JSON.stringify(data, null, 2);
        
        if (data.token) {
          localStorage.setItem('heysalad_ai_token', data.token);
        }
      } catch (error) {
        result.className = 'error';
        result.textContent = 'Error: ' + error.message;
      }
    }

    async function testGetUser() {
      const result = document.getElementById('user-result');
      const token = localStorage.getItem('heysalad_ai_token');
      
      if (!token) {
        result.className = 'error';
        result.textContent = 'No token found. Please login first.';
        return;
      }
      
      try {
        result.textContent = 'Testing get user...';
        const response = await fetch('/api/auth/me', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        const data = await response.json();
        result.className = response.ok ? 'success' : 'error';
        result.textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        result.className = 'error';
        result.textContent = 'Error: ' + error.message;
      }
    }
  </script>
</body>
</html>
